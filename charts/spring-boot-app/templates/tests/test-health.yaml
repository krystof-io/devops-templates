apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "spring-boot-app.fullname" . }}-test-health"
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "spring-boot-app.labels" . | nindent 4 }}
    app.kubernetes.io/component: test
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
  - name: health-check
    image: busybox:1.36
    command: ['sh', '-c']
    args:
      - |
        {{- if .Values.springBoot.management.enabled }}
        wget --spider --timeout=5 http://{{ include "spring-boot-app.fullname" . }}:{{ .Values.springBoot.management.port }}/actuator/health
        {{- else }}
        wget --spider --timeout=5 http://{{ include "spring-boot-app.fullname" . }}:{{ .Values.service.port }}/actuator/health
        {{- end }}
    securityContext:
      allowPrivilegeEscalation: false
      runAsNonRoot: true
      runAsUser: 65534
      capabilities:
        drop:
        - ALL
      seccompProfile:
        type: RuntimeDefault
  restartPolicy: Never
